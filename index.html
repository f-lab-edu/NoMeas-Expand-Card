<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>강제 동기 레이아웃 발생하지 않고 애니메이션 구현</title>
    <style>
      #container {
        width: 100%;
        min-height: 100vh;
        display: flex;
      }
      #card-section {
        display: flex;
        gap: 10px;
        width: 100%;
        justify-content: center;
        align-items: center;
      }
      .card {
        height: 200px;
        width: 150px;
        border: 0;
        border-radius: 20px;
        box-sizing: border-box;
        transition: transform 0.6s;
        flex: 0 0 auto;
        will-change: transform;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="card-section"></div>
    </div>
    <script>
      const cardSection = document.getElementById('card-section')
      let selectedCard = null

      const getTranslateXToViewportCenter = (node) => {
        if (node instanceof Element === false) throw new TypeError('node 확인')
        const rect = node.getBoundingClientRect()
        const contentCenterX = rect.left + rect.width / 2
        const viewportCenterX = window.innerWidth / 2

        return viewportCenterX - contentCenterX
      }

      const resetCard = (node) => {
        node.style.transform = `translate3d(0, 0, 0) scale(1)`
        node.style.zIndex = 0
      }

      const elements = ['red', 'blue', 'yellow', 'purple', 'green'].forEach(
        (color, index) => {
          const newBtn = document.createElement('button')
          newBtn.className = 'card'
          newBtn.dataset.color = color
          newBtn.style.background = color

          newBtn.addEventListener('click', (event) => {
            const current = event.currentTarget
            const prevSelected = selectedCard

            // 이전 카드와 현재 카드가 같은 경우
            if (prevSelected === current) {
              selectedCard = null
              requestAnimationFrame(() => resetCard(current))
              return
            }

            const moveX = getTranslateXToViewportCenter(current) // read(선택일 때만)
            selectedCard = current

            requestAnimationFrame(() => {
              //이전에 선택된 카드효과 제거
              if (prevSelected) resetCard(prevSelected)
              current.style.transform = `translate3d(${moveX}px, 0, 0) scale(2)`
              current.style.zIndex = 1
            })
          })

          cardSection.append(newBtn)
        }
      )
    </script>
  </body>
</html>
