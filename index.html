<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>강제 동기 레이아웃 api를 사용하여 구현</title>
    <style>
      .card {
        height: 200px;
        width: 150px;
        border: 0;
        border-radius: 20px;
        box-sizing: border-box;
        transition: transform 0.6s;
        will-change: transform;
        flex: 0 0 auto;
      }
      /* 선택한 카드가 확대 */
      .card.is-selected {
        width: 300px;
        height: 400px;
      }
    </style>
  </head>
  <body>
    <div id="container" style="width: 100%; min-height: 100vh; display: flex">
      <div
        id="card-section"
        style="
          display: flex;
          gap: 10px;
          width: 100%;
          justify-content: center;
          align-items: center;
        "
      ></div>
    </div>
    <script>
      const cardSection = document.getElementById('card-section')
      let selectedCard = null

      const getTranslateXToViewportCenter = (node) => {
        if (node instanceof Element === false) throw new TypeError('node 확인')
        const rect = node.getBoundingClientRect()
        const contentCenterX = rect.left + rect.width / 2
        const viewportCenterX = window.innerWidth / 2
        return viewportCenterX - contentCenterX
      }

      const elements = ['red', 'blue', 'yellow', 'purple', 'green'].forEach(
        (color, index) => {
          const newBtn = document.createElement('button')
          newBtn.className = 'card'
          newBtn.dataset.color = color
          newBtn.style.background = color

          newBtn.addEventListener('click', (event) => {
            const current = event.currentTarget

            if (selectedCard !== null) {
              // 선택한 카드 초기화
              selectedCard.classList.remove('is-selected')
              selectedCard.style.transform = `translateX(0px)`
              selectedCard.style.zIndex = 0
            }

            // 같은 카드를 선택한 경우 null로 초기화
            if (selectedCard === current) return (selectedCard = null)

            selectedCard = current
            selectedCard.classList.add('is-selected') // 선택한 카드 css 적용을 위한 클래스명 업데이트
            const moveX = getTranslateXToViewportCenter(selectedCard) // 위치 계산을 위해 클래스 변경 후 강제 리플로우 실행
            selectedCard.style.transform = `translateX(${moveX}px)`
            selectedCard.style.zIndex = 1
          })

          cardSection.append(newBtn)
        }
      )
    </script>
  </body>
</html>
